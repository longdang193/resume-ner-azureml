# Test configuration for FastAPI local server integration tests
# This configuration defines timeouts, performance thresholds, and test settings

server:
  default_host: "127.0.0.1"
  default_port: 8000
  port_range: [8000, 8100]  # For finding available port
  startup_timeout_seconds: 45
  shutdown_timeout_seconds: 5
  health_check_timeout_seconds: 2
  model_load_timeout_seconds: 30
  port_check_timeout_seconds: 5

performance:
  latency_thresholds:
    predict:
      p50_ms: 200
      p95_ms: 500
      max_ms: 1000
    predict_batch:
      p50_ms: 500
      p95_ms: 1500
      max_ms: 3000
    predict_file:
      p95_ms: 3000
      max_ms: 5000
    predict_file_batch:
      p95_ms: 8000
      max_ms: 12000
  
  throughput_thresholds:
    predict: 5  # req/sec
    predict_batch: 2  # batches/sec
    predict_file: 1  # files/sec
    predict_file_batch: 0.5  # batches/sec

  request_timeouts:
    text_seconds: 5
    file_seconds: 15
    batch_file_seconds: 20

  consistency_thresholds:
    latency_variance_p95_percent: 20  # Â±20%
    timeout_rate: 0  # 0%
    error_rate: 0  # 0%
    memory_growth_check: true  # No unbounded increase

  optimization:
    enable_parallel_batch: true  # Enable parallel batch processing
    onnx_threads: null  # Number of ONNX threads (null = auto-detect based on CPU cores)
    enable_extractor_cache: true  # Enable extractor caching (EasyOCR reader, etc.)
    batch_parallel_threshold: 3  # Minimum batch size to use parallel processing for texts
    file_batch_parallel_threshold: 2  # Minimum batch size to use parallel processing for files

test_data:
  base_dir: "tests/test_data"
  text_fixtures: {}  # Defined in fixtures.py
  file_fixtures: {}  # Defined in fixtures.py
  generate_script: "tests/test_data/generate_test_files.py"  # For creating test files

stability_tests:
  # Configuration for test_repeated_file_processing
  repeated_file_processing:
    num_files: 3  # Number of files to process (file_1, file_2, file_3)
    num_iterations: 2  # Number of times to process each file
  
  # Configuration for test_comprehensive_multi_file_multi_iteration
  comprehensive_stress_test:
    num_files: 5 # Number of files to process (file_1 through file_10)
    num_texts: 10  # Number of texts to process (text_1 through text_10)
    num_iterations: 5  # Number of iterations for each file/text
    max_performance_degradation_percent: 50  # Allow up to 50% degradation
    max_entity_count_variance: 2  # Allow variance of up to 2 entities

